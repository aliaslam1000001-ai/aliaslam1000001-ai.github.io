<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        body { font-family: sans-serif; background-color: #1e1e1e; color: #fff; padding: 20px; }
        
        h1 { text-align: center; color: #ff5555; }
        
        .container { max-width: 900px; margin: 0 auto; background: #2d2d2d; padding: 20px; border-radius: 10px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #444; }
        th { background-color: #333; color: #aaa; }
        
        .btn-delete { 
            background-color: #ff5555; color: white; border: none; 
            padding: 5px 10px; cursor: pointer; border-radius: 5px; 
        }
        .btn-delete:hover { background-color: #d00000; }

        .nav-btn { background: #555; color: white; text-decoration: none; padding: 10px 20px; border-radius: 5px; display: inline-block; margin-bottom: 20px;}

        /* Badge for Room Name */
        .badge { padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; background: #764ba2; }
    </style>
</head>
<body>

    <div class="container">
        <a href="index.html" class="nav-btn">‚¨Ö Back to Chat</a>
        <h1>üõ†Ô∏è Master Admin Panel</h1>
        <p>Manage messages across all rooms.</p>

        <table>
            <thead>
                <tr>
                    <th>Room</th>
                    <th>User</th>
                    <th>Message</th>
                    <th>Time</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

        // --- YOUR FIREBASE CONFIG ---
        // (I pre-filled this based on your previous messages)
        const firebaseConfig = {
            apiKey: "AIzaSyDyOcdbasPRMo8FHxOyLw0WnmhkwOSGF8o",
            authDomain: "mypersonalchatboxapp.firebaseapp.com",
            databaseURL: "https://mypersonalchatboxapp-default-rtdb.firebaseio.com",
            projectId: "mypersonalchatboxapp",
            storageBucket: "mypersonalchatboxapp.firebasestorage.app",
            messagingSenderId: "290120332790",
            appId: "1:290120332790:web:14e0487f7d37b5e404c3d7",
            measurementId: "G-0695T29ZT6"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const ROOM_PASSWORD = "admin123";

        // 1. SECURITY CHECK
        const password = prompt("Enter Admin Password:");
        if(password !== ROOM_PASSWORD) {
            document.body.innerHTML = "<h1 style='text-align:center; margin-top:50px;'>‚õî ACCESS DENIED</h1>";
            throw new Error("Wrong Password");
        }

        // 2. LOAD ALL DATA
        const roomsRef = ref(db, 'rooms');

        onValue(roomsRef, (snapshot) => {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = ''; // Clear table
            
            const data = snapshot.val();
            
            if (data) {
                // Loop through Rooms (General, Tech, etc.)
                Object.keys(data).forEach(roomName => {
                    const roomData = data[roomName];
                    
                    // Check if room has messages
                    if (roomData.messages) {
                        // Loop through Messages in that room
                        Object.entries(roomData.messages).forEach(([msgId, msgData]) => {
                            
                            const row = document.createElement('tr');
                            
                            let content = msgData.type === 'image' ? '[Image Attachment]' : msgData.message;

                            row.innerHTML = `
                                <td><span class="badge">${roomName.toUpperCase()}</span></td>
                                <td><strong>${msgData.name}</strong></td>
                                <td style="color: #ccc;">${content}</td>
                                <td>${msgData.time}</td>
                                <td>
                                    <button class="btn-delete" onclick="deleteMsg('${roomName}', '${msgId}')">Delete</button>
                                </td>
                            `;
                            tbody.appendChild(row);
                        });
                    }
                });
            } else {
                tbody.innerHTML = "<tr><td colspan='5' style='text-align:center'>No messages found in database.</td></tr>";
            }
        });

        // 3. DELETE FUNCTION (Global Scope)
        window.deleteMsg = function(roomName, msgId) {
            if(confirm("Are you sure you want to delete this message?")) {
                const messageRef = ref(db, `rooms/${roomName}/messages/${msgId}`);
                remove(messageRef)
                    .then(() => console.log("Deleted"))
                    .catch((err) => alert("Error: " + err.message));
            }
        }
    </script>

</body>
</html>
